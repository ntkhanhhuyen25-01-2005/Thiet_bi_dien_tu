{% extends "Client/base.html" %}

{% block title %}Thanh toán - Thiết bị điện tử{% endblock %}

{% block content %}
<div class="container mb-4">
  <h2 class="mb-4 text-center text-primary">Thanh toán</h2>
  <div class="row g-4">
    <div class="col-md-7">
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">Thông tin khách hàng</h5>
        </div>
        <div class="card-body">
          <!-- Thông báo đã đăng nhập -->
          {% if user %}
          <div class="alert alert-success mb-3">
            <i class="fa-solid fa-user-check"></i> Đã đăng nhập với tài khoản: <strong>{{ user.username }}</strong>
          </div>
          {% endif %}
          
          <form id="checkoutForm" method="POST" action="{{ url_for('thanhtoan') }}">
            <div class="mb-3">
              <label class="form-label">Họ và tên</label>
              <input type="text" name="full_name" class="form-control" 
                     placeholder="Nhập họ tên" 
                     value="{% if user %}{{ user.first_name }} {{ user.last_name }}{% endif %}" 
                     required />
            </div>
            <div class="mb-3">
              <label class="form-label">Số điện thoại</label>
              <input type="text" name="phone" class="form-control" placeholder="Nhập số điện thoại" required />
            </div>
            <div class="mb-3">
              <label class="form-label">Email</label>
              <input type="email" name="email" class="form-control" 
                     placeholder="Nhập email" 
                     value="{% if user %}{{ user.email }}{% endif %}" 
                     required />
            </div>
            <div class="mb-3">
              <label class="form-label">Địa chỉ giao hàng</label>
              <textarea class="form-control" name="address" rows="3" placeholder="Nhập địa chỉ chi tiết" required></textarea>
            </div>
          </form>
        </div>
      </div>

      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">Phương thức thanh toán</h5>
        </div>
          <div class="card-body">
          <div class="form-check mb-2">
            <input class="form-check-input" type="radio" form="checkoutForm" name="payment" id="cod" value="cod" checked />
            <label class="form-check-label" for="cod">Thanh toán khi nhận hàng (COD)</label>
          </div>
          <div class="form-check mb-2">
            <input class="form-check-input" type="radio" form="checkoutForm" name="payment" id="bank" value="bank" />
            <label class="form-check-label" for="bank">Chuyển khoản ngân hàng</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" form="checkoutForm" name="payment" id="momo" value="momo" />
            <label class="form-check-label" for="momo">Ví MoMo</label>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-5">
      <div class="card shadow-sm">
        <div class="card-header bg-success text-white">
          <h5 class="mb-0">Đơn hàng của bạn</h5>
        </div>
        <div class="card-body">
          <table class="table table-sm align-middle">
            <tbody>
              {% for it in items %}
              <tr>
                <td>{{ it.product.name }} × {{ it.quantity }}</td>
                <td class="text-end">{{ '{:,.0f}'.format(it.line_total).replace(',', '.') }} đ</td>
              </tr>
              {% endfor %}
              <tr class="border-top">
                <th>Tạm tính</th>
                <td class="text-end">{{ '{:,.0f}'.format(subtotal).replace(',', '.') }} đ</td>
              </tr>
              <tr>
                <th>Phí vận chuyển</th>
                <td class="text-end">{{ '{:,.0f}'.format(shipping).replace(',', '.') }} đ</td>
              </tr>
              <tr class="border-top">
                <th class="text-danger">Tổng cộng</th>
                <td class="text-end fw-bold text-danger">{{ '{:,.0f}'.format(grand_total).replace(',', '.') }} đ</td>
              </tr>
            </tbody>
          </table>
          <div class="d-flex justify-content-between">
            <a href="{{ url_for('giohang') }}" class="btn btn-outline-secondary"><i class="fa-solid fa-arrow-left"></i> Quay lại giỏ hàng</a>
            <button type="submit" form="checkoutForm" class="btn btn-success"><i class="fa-solid fa-credit-card"></i> Xác nhận đặt hàng</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}


